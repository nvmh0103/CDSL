CREATE DATABASE DE2MOI
DROP DATABASE DE2
USE DE2MOI
CREATE TABLE LOP(
    MALOP VARCHAR(3) PRIMARY KEY,
    TENLOP VARCHAR(40),
    TRGLOP VARCHAR(5),
    SISO TINYINT
)
CREATE TABLE HOCVIEN(
    MAHV VARCHAR(5) PRIMARY KEY,
    HO VARCHAR(40),
    TEN VARCHAR(40),
    NGSINH SMALLDATETIME,
    GIOITINH VARCHAR(3),
    NOISINH VARCHAR(40),
    MALOP VARCHAR(3),
    CONSTRAINT FK_MALOP FOREIGN KEY (MALOP) REFERENCES LOP(MALOP),
)
CREATE TABLE MONHOC(
    MAMH VARCHAR(10) PRIMARY KEY,
    TENMH VARCHAR(40),
    TCLT TINYINT,
    TCTH TINYINT,
    MAKHOA VARCHAR(4)
)
CREATE TABLE KETQUATHI(
    MAHV VARCHAR(5),
    MAMH VARCHAR(10),
    LANTHI TINYINT,
    NGTHI SMALLDATETIME,
    DIEM numeric(4,2),
    KQUA VARCHAR(10),
    CONSTRAINT PK PRIMARY KEY (MAHV,MAMH,LANTHI),
    CONSTRAINT FK_MAHV FOREIGN KEY (MAHV) REFERENCES HOCVIEN(MAHV),
    CONSTRAINT FK_MAMH FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH),
)

-- NHAP 
INSERT INTO LOP(MALOP,TENLOP,TRGLOP,SISO) VALUES ('L01','TEN01','HV01',44)
INSERT INTO LOP(MALOP,TENLOP,TRGLOP,SISO) VALUES ('L02','TEN02','HV02',40)
INSERT INTO LOP(MALOP,TENLOP,TRGLOP,SISO) VALUES ('L03','TEN03','HV03',41)
INSERT INTO LOP(MALOP,TENLOP,TRGLOP,SISO) VALUES ('L04','TEN04','HV04',45)
INSERT INTO LOP(MALOP,TENLOP,TRGLOP,SISO) VALUES ('L05','TEN05','HV05',42)
INSERT INTO LOP(MALOP,TENLOP,TRGLOP,SISO) VALUES ('L06','TEN06','HV06',41)
INSERT INTO LOP(MALOP,TENLOP,TRGLOP,SISO) VALUES ('L07','TEN07','HV07',45)
INSERT INTO LOP(MALOP,TENLOP,TRGLOP,SISO) VALUES ('L08','TEN08','HV08',46)
INSERT INTO LOP(MALOP,TENLOP,TRGLOP,SISO) VALUES ('L09','TEN09','HV09',42)
INSERT INTO LOP(MALOP,TENLOP,TRGLOP,SISO) VALUES ('L10','TEN10','HV10',41)


INSERT INTO HOCVIEN(MAHV,HO,TEN,NGSINH,GIOITINH,NOISINH,MALOP) VALUES ('HV01','NGUYEN','THU','13/01/2001','NAM','BEN TRE','L01')
INSERT INTO HOCVIEN(MAHV,HO,TEN,NGSINH,GIOITINH,NOISINH,MALOP) VALUES ('HV02','NGUYEN','BAO','12/05/2000','NAM','TPHCM','L02')

INSERT INTO HOCVIEN(MAHV,HO,TEN,NGSINH,GIOITINH,NOISINH,MALOP) VALUES ('HV03','TRAN','THU','14/02/2001','NAM','BEN TRE','L03')
INSERT INTO HOCVIEN(MAHV,HO,TEN,NGSINH,GIOITINH,NOISINH,MALOP) VALUES ('HV04','THU','BAO','22/08/2000','NAM','TPHCM','L04')

INSERT INTO HOCVIEN(MAHV,HO,TEN,NGSINH,GIOITINH,NOISINH,MALOP) VALUES ('HV05','DUONG','BAO','10/11/2001','NAM','BEN TRE','L05')
INSERT INTO HOCVIEN(MAHV,HO,TEN,NGSINH,GIOITINH,NOISINH,MALOP) VALUES ('HV06','TRAN','BAO','12/05/2000','NU','TPHCM','L06')

INSERT INTO HOCVIEN(MAHV,HO,TEN,NGSINH,GIOITINH,NOISINH,MALOP) VALUES ('HV07','HUYNH','THI','23/12/1999','NU','BEN TRE','L07')
INSERT INTO HOCVIEN(MAHV,HO,TEN,NGSINH,GIOITINH,NOISINH,MALOP) VALUES ('HV08','TRAN','LIEN','13/06/2001','NU','TPHCM','L08')

INSERT INTO HOCVIEN(MAHV,HO,TEN,NGSINH,GIOITINH,NOISINH,MALOP) VALUES ('HV09','GIA','BAO','10/12/2001','NU','BEN TRE','L09')
INSERT INTO HOCVIEN(MAHV,HO,TEN,NGSINH,GIOITINH,NOISINH,MALOP) VALUES ('HV10','TRAN','HAO','11/05/1999','NU','TPHCM','L10')
INSERT INTO HOCVIEN(MAHV,HO,TEN,NGSINH,GIOITINH,NOISINH,MALOP) VALUES ('HV11','TRAN','ACH','11/05/1999','NU','TPHCM','L10')

INSERT INTO MONHOC(MAMH,TENMH,TCLT,TCTH,MAKHOA) VALUES ('MH1','TOAN','1','1','HTTT') 
INSERT INTO MONHOC(MAMH,TENMH,TCLT,TCTH,MAKHOA) VALUES ('MH2','TV','2','1','T')
INSERT INTO MONHOC(MAMH,TENMH,TCLT,TCTH,MAKHOA) VALUES ('MH3','ANHZAN','3','1','HTTT')
INSERT INTO MONHOC(MAMH,TENMH,TCLT,TCTH,MAKHOA) VALUES ('MH4','DIA','1','1','T')
INSERT INTO MONHOC(MAMH,TENMH,TCLT,TCTH,MAKHOA) VALUES ('MH5','SU','2','1','T')
INSERT INTO MONHOC(MAMH,TENMH,TCLT,TCTH,MAKHOA) VALUES ('MH6','LY','3','1','T')
INSERT INTO MONHOC(MAMH,TENMH,TCLT,TCTH,MAKHOA) VALUES ('MH7','TOAN','2','1','HTTT')
INSERT INTO MONHOC(MAMH,TENMH,TCLT,TCTH,MAKHOA) VALUES ('MH8','TOAN','3','1','T')
INSERT INTO MONHOC(MAMH,TENMH,TCLT,TCTH,MAKHOA) VALUES ('MH9','TOAN','2','1','HTTT')
INSERT INTO MONHOC(MAMH,TENMH,TCLT,TCTH,MAKHOA) VALUES ('MH10','TOAN','5','1','T')


SET DATEFORMAT DMY
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV01','MH1','1','13/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV02','MH2','1','14/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV03','MH3','1','14/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV04','MH4','1','15/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV05','MH5','1','15/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV06','MH6','1','16/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV07','MH7','1','17/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV07','MH3','1','17/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV07','MH1','1','17/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV07','MH9','1','17/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV08','MH8','1','18/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV09','MH9','1','19/1/2020','8','DAU')
INSERT INTO KETQUATHI(MAHV,MAMH,LANTHI,NGTHI,DIEM,KQUA) VALUES('HV10','MH10','1','19/1/2020','8','DAU')

--CAU1
SELECT MAHV,HO,TEN,NGSINH,HOCVIEN.MALOP
FROM HOCVIEN,LOP
WHERE HOCVIEN.MALOP=LOP.MALOP AND LOP.TRGLOP=HOCVIEN.MAHV
--CAU2
SELECT TENMH,COUNT(HOCVIEN.MAHV) AS SOLUONG
FROM MONHOC,HOCVIEN,KETQUATHI KQT
WHERE KQT.MAHV=HOCVIEN.MAHV AND KQT.MAMH=MONHOC.MAMH AND KQUA='DAU' AND LANTHI='1'
GROUP BY MONHOC.TENMH

--CAU3
SELECT MAHV,HO,TEN
FROM HOCVIEN
WHERE MAHV NOT IN (
    SELECT MAHV
    FROM KETQUATHI
)
--CAU4
SELECT HV.MAHV,HO,TEN
FROM HOCVIEN HV
WHERE NOT EXISTS(
    SELECT *
    FROM MONHOC MH
    WHERE MH.MAKHOA='HTTT' AND NOT EXISTS(
        SELECT *
        FROM KETQUATHI KQ
        WHERE (KQ.MAHV=HV.MAHV AND MH.MAMH=KQ.MAMH) AND KQUA='DAU' AND LANTHI=1 
    )
)





